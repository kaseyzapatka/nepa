# Energy Classification Filtering Logic

This document summarizes all filtering iterations used to classify projects as "Clean", "Fossil", or "Other" energy types.

## Overview

The energy classification pipeline applies multiple filtering layers to ensure accurate categorization. Projects initially classified as "Clean" may be reclassified to "Other" if they match exclusion criteria.

---

## Filter 1: Utilities + Non-Energy Exclusions

**Location:** `code/extract/classify_energy.py` → `is_utilities_to_filter_out()`

**Criteria:** Projects are excluded from "Clean" if they have ONLY:
- "Utilities (electricity, gas, telecommunications)" tag
- PLUS one of these non-energy tags (and no other tags):
  - Broadband
  - Waste Management
  - Land Development - Housing
  - Land Development - Other
  - Land Development - Urban

**Rationale:** These are likely telecommunications infrastructure or development projects with utility connections, not clean energy production projects.

---

## Filter 2: Military / Defense Site Exclusions

**Location:** `code/extract/extract_data.py` → `load_military_project_ids()`

**Criteria:** Projects with BOTH:
- "Military and Defense" project_type tag
- "Nuclear" project_type tag

**Source:** Project IDs loaded from `notes/military_project_ids_to_filter.csv`

**Rationale:** Defense-related nuclear projects (weapons programs, naval reactors) are not civilian clean energy.

**Note:** The CSV is generated by running the exploratory section in `code/deliverable1/02_agency.R`.

---

## Filter 3: Nuclear Waste Management Exclusions

**Location:** `code/extract/extract_data.py` → `is_nuclear_waste_project()`

**Criteria:** Projects are excluded from "Clean" if they have BOTH:
- "Waste Management" project_type tag
- "Nuclear" project_type tag

AND are associated with one of these DOE offices (checked in lead_agency, project_sponsor, OR project_title):

### NNSA (National Nuclear Security Administration) Sites
- National Nuclear Security Administration, NNSA
- Kansas City Field Office / National Security Campus
- Livermore Field Office / Site Office, Lawrence Livermore National Laboratory
- Los Alamos (Field Office, Site Office, Area Office, National Laboratory)
- Naval Nuclear Propulsion Program / Laboratory
- Nevada Field Office / National Security Site
- Pantex Field Office / Plant
- Sandia Site Office / Field Office / National Laboratories
- Savannah River (Mission Completion, Operations Office, Field Office, Site)
- Y-12 Site Office / Field Office / National Security Complex

### Office of Legacy Management (LM) Sites
- Office of Legacy Management
- Legacy Management
- Albuquerque Operations Office
- Grand Junction Office

### Office of Environmental Management (EM) Sites
- Office of Environmental Management
- Environmental Management
- Hanford Site, Hanford Mission Integration Solutions
- Richland, Richland Operations Office
- Office of River Protection
- Paducah, Paducah Site
- Portsmouth, Portsmouth Site, Portsmouth and Paducah Field Office
- Oak Ridge, Oak Ridge Office of Environmental Management
- Waste Isolation Pilot Plant (WIPP)
- Carlsbad, Carlsbad Field Office

**Source:** Exclusion terms loaded from `notes/agencies_to_be_excluded.txt`

**Rationale:** Nuclear waste cleanup, storage, and legacy site management are not clean energy production.

---

## Filter 4: Title-Based Filtering (Added 2024)

**Location:** Same as Filter 3, extended to check `project_title`

**Criteria:** Same as Filter 3, but also checks `project_title` field for exclusion terms.

**Rationale:** Some projects had missing or incomplete `project_sponsor` fields, causing them to slip through the original filter. For example, "Hanford Site" might appear only in the title. This catches such cases.

**Impact:** Captured ~84 additional projects that were previously misclassified.

---

## Implementation Notes

1. **Order of operations:** Filters are applied after initial energy classification in `classify_energy.py`, during the `apply_energy_type_filters()` step.

2. **Affected columns:**
   - `project_energy_type` - Updated from "Clean" to "Other"
   - `project_energy_type_strict` - Updated from "Clean" to "Other"

3. **Flag columns added:**
   - `project_is_military_nuclear` - Boolean
   - `project_is_nuclear_waste` - Boolean
   - `project_utilities_to_filter_out` - Boolean (in classify_energy.py)

4. **File dependencies:**
   - `notes/agencies_to_be_excluded.txt` - Exclusion terms (editable)
   - `notes/military_project_ids_to_filter.csv` - Military project IDs (generated by R)

---

## Maintenance

To add new exclusion terms:
1. Edit `notes/agencies_to_be_excluded.txt`
2. Add terms under the appropriate section (NNSA, LM, or EM)
3. Re-run `python code/extract/extract_data.py --mode analysis`

To regenerate military project IDs:
1. Run the exploratory section in `code/deliverable1/02_agency.R`
2. This writes to `notes/military_project_ids_to_filter.csv`
